let postAPI = require('../../utils/api.js'); const Toptips = require('../../dist/toptips/index'); const app = getApp(); Page({ data: { id: '', my_text: '', check_value: [], entryList: [] }, onLoad: function (options) { let id = options.id; this.setData({ id: id }); this.getOptions() }, getDataSuccess: function (res) { wx.hideLoading(); console.log(res); if (res.code == 0) { if (res.list != null && res.list.length > 0) { this.setData({ entryList: res.list }) } } else { app.showResultToast(res, 'info') } }, getOptions: function () { wx.showLoading({ title: '加载中...', mask: true }); postAPI.post('p/report/getOptions', { token: app.globalData.userId, type: "ticket" }, this.getDataSuccess, app.getDataFail, 0) }, checkboxChange: function (e) { let value = e.detail.value; this.setData({ check_value: value }) }, getMyText: function (e) { let text = e.detail.value.replace(/\s+/g, ''); this.setData({ my_text: text }) }, updataInfo: function () { if (this.checkMyValue()) { wx.showLoading({ title: '加载中...', mask: true }); postAPI.checkPost('p/report/send', { token: app.globalData.userId, type: "ticket", id: this.data.id, keys: this.data.check_value, remark: this.data.my_text }, this.getReportSuccess) } }, checkMyValue: function () { let myCheck = this.data.check_value; let text = this.data.my_text; if (text || myCheck.length > 0) { return true } this.showTopTips('请选择或填写报错信息'); return false }, getReportSuccess: function (res) { wx.hideLoading(); this.showTopTips(res.msg); if (res.code == 0) { setTimeout(function () { wx.navigateBack({}) }, 1200) } }, showTopTips(contents) { Toptips({ duration: 1000, content: contents }) } })